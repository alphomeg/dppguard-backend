2025-12-05 00:02:29.255 | ERROR    | app.api.v1.index:readiness_check:19 - Database readiness check failed
Traceback (most recent call last):

  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x0000022132DA1440>
    │                        └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
    └ <sqlalchemy.engine.base.Connection object at 0x00000221354A5A90>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000002213293E7A0>
           │    └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
           └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000002213296C900>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000002213293F420>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x000002213296E700>
          └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x00000221354E8740>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('invalid dsn: invalid connection option "check_same_thread"\n')
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 175, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000002213293E520>
           └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000022135447950>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x00000221354E81C0>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('invalid dsn: invalid connection option "check_same_thread"\n')
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000022135447950>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x00000221351F9D00>
    │    │                               └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000022135447950>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'dbname': 'dpp-guard', 'user': 'postgres', 'password': 'admin', 'port': 5432, 'check_same_thread': False}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x0000022132E4CE00>
           └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002213528E3C0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           │    │            │        │        └ {'host': 'localhost', 'dbname': 'dpp-guard', 'user': 'postgres', 'password': 'admin', 'port': 5432, 'check_same_thread': False}
           │    │            │        └ ()
           │    │            └ <function connect at 0x0000022135366FC0>
           │    └ <module 'psycopg2' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\psycopg2\\__init__.py'>
           └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002213528E3C0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\psycopg2\__init__.py", line 134, in connect
    dsn = _ext.make_dsn(dsn, **kwargs)
          │    │        │      └ {'host': 'localhost', 'dbname': 'dpp-guard', 'user': 'postgres', 'password': 'admin', 'port': 5432, 'check_same_thread': False}
          │    │        └ None
          │    └ <function make_dsn at 0x0000022135367880>
          └ <module 'psycopg2.extensions' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\psycopg2\\extensions.py'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\psycopg2\extensions.py", line 167, in make_dsn
    parse_dsn(dsn)
    │         └ 'host=localhost dbname=dpp-guard user=postgres password=admin port=5432 check_same_thread=False'
    └ <built-in function parse_dsn>

psycopg2.ProgrammingError: invalid dsn: invalid connection option "check_same_thread"



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.13_3.13.2544.0_x64__qbz5n2kfra8p0\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000002212EFD60C0>
    └ <WorkerThread(AnyIO worker thread, started 18788)>
  File "C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.13_3.13.2544.0_x64__qbz5n2kfra8p0\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x0000022135497A60>
    └ <WorkerThread(AnyIO worker thread, started 18788)>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 986, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function readiness_check at 0x000002213547FB00>, session=<sqlmodel.orm.session.Session object at 0x0000022...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x00000221354A18C0>

> File "C:\Work\dppguard-backend\app\api\v1\index.py", line 17, in readiness_check
    session.exec(text("SELECT 1"))
    │       │    └ <function text at 0x0000022132D23380>
    │       └ <function Session.exec at 0x00000221352109A0>
    └ <sqlmodel.orm.session.Session object at 0x00000221354A57F0>

  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlmodel\orm\session.py", line 83, in exec
    results = super().execute(
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x00000221351113A0>
           └ <sqlmodel.orm.session.Session object at 0x00000221354A57F0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2239, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
           │    └ <function Session._connection_for_bind at 0x0000022135111120>
           └ <sqlmodel.orm.session.Session object at 0x00000221354A57F0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2108, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
           │     └ <function SessionTransaction._connection_for_bind at 0x0000022135107BA0>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000221354C1850>
  File "<string>", line 2, in _connection_for_bind
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql://postgres:***@localhost:5432/dpp-guard), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000221354C1850>
                └ <function SessionTransaction._connection_for_bind at 0x00000221351079C0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1187, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x0000022132DA13A0>
           └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    Connection._handle_dbapi_exception_noconnection(
    │          └ <classmethod(<function Connection._handle_dbapi_exception_noconnection at 0x0000022132D9EC00>)>
    └ <class 'sqlalchemy.engine.base.Connection'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2440, in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ ProgrammingError('invalid dsn: invalid connection option "check_same_thread"\n')
          │                    │              └ (<class 'psycopg2.ProgrammingError'>, ProgrammingError('invalid dsn: invalid connection option "check_same_thread"\n'), <trac...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.ProgrammingError) invalid dsn: invalid connection option "check_same_thread"\n')
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x0000022132DA1440>
    │                        └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
    └ <sqlalchemy.engine.base.Connection object at 0x00000221354A5A90>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000002213293E7A0>
           │    └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
           └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000002213296C900>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000002213293F420>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x000002213296E700>
          └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x00000221354E8740>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('invalid dsn: invalid connection option "check_same_thread"\n')
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 175, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000002213293E520>
           └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000022135447950>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x00000221354E81C0>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('invalid dsn: invalid connection option "check_same_thread"\n')
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000022135447950>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x00000221351F9D00>
    │    │                               └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000022135447950>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'dbname': 'dpp-guard', 'user': 'postgres', 'password': 'admin', 'port': 5432, 'check_same_thread': False}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x0000022132E4CE00>
           └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002213528E3C0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           │    │            │        │        └ {'host': 'localhost', 'dbname': 'dpp-guard', 'user': 'postgres', 'password': 'admin', 'port': 5432, 'check_same_thread': False}
           │    │            │        └ ()
           │    │            └ <function connect at 0x0000022135366FC0>
           │    └ <module 'psycopg2' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\psycopg2\\__init__.py'>
           └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002213528E3C0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\psycopg2\__init__.py", line 134, in connect
    dsn = _ext.make_dsn(dsn, **kwargs)
          │    │        │      └ {'host': 'localhost', 'dbname': 'dpp-guard', 'user': 'postgres', 'password': 'admin', 'port': 5432, 'check_same_thread': False}
          │    │        └ None
          │    └ <function make_dsn at 0x0000022135367880>
          └ <module 'psycopg2.extensions' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\psycopg2\\extensions.py'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\psycopg2\extensions.py", line 167, in make_dsn
    parse_dsn(dsn)
    │         └ 'host=localhost dbname=dpp-guard user=postgres password=admin port=5432 check_same_thread=False'
    └ <built-in function parse_dsn>

sqlalchemy.exc.ProgrammingError: (psycopg2.ProgrammingError) invalid dsn: invalid connection option "check_same_thread"

(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-05 00:02:30.185 | ERROR    | app.api.v1.index:readiness_check:19 - Database readiness check failed
Traceback (most recent call last):

  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x0000022132DA1440>
    │                        └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
    └ <sqlalchemy.engine.base.Connection object at 0x000002213549EE90>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000002213293E7A0>
           │    └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
           └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000002213296C900>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000002213293F420>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x000002213296E700>
          └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002213569A480>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('invalid dsn: invalid connection option "check_same_thread"\n')
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 175, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000002213293E520>
           └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000022135565F10>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002213569A100>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('invalid dsn: invalid connection option "check_same_thread"\n')
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000022135565F10>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x00000221351F9D00>
    │    │                               └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000022135565F10>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'dbname': 'dpp-guard', 'user': 'postgres', 'password': 'admin', 'port': 5432, 'check_same_thread': False}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x0000022132E4CE00>
           └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002213528E3C0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           │    │            │        │        └ {'host': 'localhost', 'dbname': 'dpp-guard', 'user': 'postgres', 'password': 'admin', 'port': 5432, 'check_same_thread': False}
           │    │            │        └ ()
           │    │            └ <function connect at 0x0000022135366FC0>
           │    └ <module 'psycopg2' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\psycopg2\\__init__.py'>
           └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002213528E3C0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\psycopg2\__init__.py", line 134, in connect
    dsn = _ext.make_dsn(dsn, **kwargs)
          │    │        │      └ {'host': 'localhost', 'dbname': 'dpp-guard', 'user': 'postgres', 'password': 'admin', 'port': 5432, 'check_same_thread': False}
          │    │        └ None
          │    └ <function make_dsn at 0x0000022135367880>
          └ <module 'psycopg2.extensions' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\psycopg2\\extensions.py'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\psycopg2\extensions.py", line 167, in make_dsn
    parse_dsn(dsn)
    │         └ 'host=localhost dbname=dpp-guard user=postgres password=admin port=5432 check_same_thread=False'
    └ <built-in function parse_dsn>

psycopg2.ProgrammingError: invalid dsn: invalid connection option "check_same_thread"



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.13_3.13.2544.0_x64__qbz5n2kfra8p0\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000002212EFD60C0>
    └ <WorkerThread(AnyIO worker thread, started 18788)>
  File "C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.13_3.13.2544.0_x64__qbz5n2kfra8p0\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x0000022135497A60>
    └ <WorkerThread(AnyIO worker thread, started 18788)>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 986, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function readiness_check at 0x000002213547FB00>, session=<sqlmodel.orm.session.Session object at 0x0000022...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x00000221354A3E00>

> File "C:\Work\dppguard-backend\app\api\v1\index.py", line 17, in readiness_check
    session.exec(text("SELECT 1"))
    │       │    └ <function text at 0x0000022132D23380>
    │       └ <function Session.exec at 0x00000221352109A0>
    └ <sqlmodel.orm.session.Session object at 0x000002213549EC10>

  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlmodel\orm\session.py", line 83, in exec
    results = super().execute(
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x00000221351113A0>
           └ <sqlmodel.orm.session.Session object at 0x000002213549EC10>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2239, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
           │    └ <function Session._connection_for_bind at 0x0000022135111120>
           └ <sqlmodel.orm.session.Session object at 0x000002213549EC10>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2108, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
           │     └ <function SessionTransaction._connection_for_bind at 0x0000022135107BA0>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000022135699D90>
  File "<string>", line 2, in _connection_for_bind
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql://postgres:***@localhost:5432/dpp-guard), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000022135699D90>
                └ <function SessionTransaction._connection_for_bind at 0x00000221351079C0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1187, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x0000022132DA13A0>
           └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    Connection._handle_dbapi_exception_noconnection(
    │          └ <classmethod(<function Connection._handle_dbapi_exception_noconnection at 0x0000022132D9EC00>)>
    └ <class 'sqlalchemy.engine.base.Connection'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2440, in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ ProgrammingError('invalid dsn: invalid connection option "check_same_thread"\n')
          │                    │              └ (<class 'psycopg2.ProgrammingError'>, ProgrammingError('invalid dsn: invalid connection option "check_same_thread"\n'), <trac...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.ProgrammingError) invalid dsn: invalid connection option "check_same_thread"\n')
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x0000022132DA1440>
    │                        └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
    └ <sqlalchemy.engine.base.Connection object at 0x000002213549EE90>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000002213293E7A0>
           │    └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
           └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000002213296C900>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000002213293F420>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x000002213296E700>
          └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002213569A480>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('invalid dsn: invalid connection option "check_same_thread"\n')
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 175, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000002213293E520>
           └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000022135565F10>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002213569A100>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('invalid dsn: invalid connection option "check_same_thread"\n')
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000022135565F10>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x00000221351F9D00>
    │    │                               └ <sqlalchemy.pool.impl.QueuePool object at 0x000002213528E7B0>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000022135565F10>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'dbname': 'dpp-guard', 'user': 'postgres', 'password': 'admin', 'port': 5432, 'check_same_thread': False}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x0000022132E4CE00>
           └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002213528E3C0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           │    │            │        │        └ {'host': 'localhost', 'dbname': 'dpp-guard', 'user': 'postgres', 'password': 'admin', 'port': 5432, 'check_same_thread': False}
           │    │            │        └ ()
           │    │            └ <function connect at 0x0000022135366FC0>
           │    └ <module 'psycopg2' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\psycopg2\\__init__.py'>
           └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002213528E3C0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\psycopg2\__init__.py", line 134, in connect
    dsn = _ext.make_dsn(dsn, **kwargs)
          │    │        │      └ {'host': 'localhost', 'dbname': 'dpp-guard', 'user': 'postgres', 'password': 'admin', 'port': 5432, 'check_same_thread': False}
          │    │        └ None
          │    └ <function make_dsn at 0x0000022135367880>
          └ <module 'psycopg2.extensions' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\psycopg2\\extensions.py'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\psycopg2\extensions.py", line 167, in make_dsn
    parse_dsn(dsn)
    │         └ 'host=localhost dbname=dpp-guard user=postgres password=admin port=5432 check_same_thread=False'
    └ <built-in function parse_dsn>

sqlalchemy.exc.ProgrammingError: (psycopg2.ProgrammingError) invalid dsn: invalid connection option "check_same_thread"

(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-05 00:03:30.970 | ERROR    | app.api.v1.index:readiness_check:19 - Database readiness check failed
Traceback (most recent call last):

  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x000001CFFDBA1440>
    │                        └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
    └ <sqlalchemy.engine.base.Connection object at 0x000001CFFF295A90>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000001CFFD73E7A0>
           │    └ <sqlalchemy.pool.impl.QueuePool object at 0x000001CFFF08E7B0>
           └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.QueuePool object at 0x000001CFFF08E7B0>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000001CFFD76C900>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.QueuePool object at 0x000001CFFF08E7B0>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000001CFFD73F420>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x000001CFFD76E700>
          └ <sqlalchemy.pool.impl.QueuePool object at 0x000001CFFF08E7B0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001CFFF2D8C40>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('invalid dsn: invalid connection option "check_same_thread"\n')
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 175, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000001CFFD73E520>
           └ <sqlalchemy.pool.impl.QueuePool object at 0x000001CFFF08E7B0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.QueuePool object at 0x000001CFFF08E7B0>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000001CFFF237950>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001CFFF2D8240>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('invalid dsn: invalid connection option "check_same_thread"\n')
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000001CFFF237950>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x000001CFFDFF5D00>
    │    │                               └ <sqlalchemy.pool.impl.QueuePool object at 0x000001CFFF08E7B0>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000001CFFF237950>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'dbname': 'dpp-guard', 'user': 'postgres', 'password': 'admin', 'port': 5432, 'check_same_thread': False}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x000001CFFDC4CE00>
           └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001CFFF08E3C0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           │    │            │        │        └ {'host': 'localhost', 'dbname': 'dpp-guard', 'user': 'postgres', 'password': 'admin', 'port': 5432, 'check_same_thread': False}
           │    │            │        └ ()
           │    │            └ <function connect at 0x000001CFFF166FC0>
           │    └ <module 'psycopg2' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\psycopg2\\__init__.py'>
           └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001CFFF08E3C0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\psycopg2\__init__.py", line 134, in connect
    dsn = _ext.make_dsn(dsn, **kwargs)
          │    │        │      └ {'host': 'localhost', 'dbname': 'dpp-guard', 'user': 'postgres', 'password': 'admin', 'port': 5432, 'check_same_thread': False}
          │    │        └ None
          │    └ <function make_dsn at 0x000001CFFF167880>
          └ <module 'psycopg2.extensions' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\psycopg2\\extensions.py'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\psycopg2\extensions.py", line 167, in make_dsn
    parse_dsn(dsn)
    │         └ 'host=localhost dbname=dpp-guard user=postgres password=admin port=5432 check_same_thread=False'
    └ <built-in function parse_dsn>

psycopg2.ProgrammingError: invalid dsn: invalid connection option "check_same_thread"



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.13_3.13.2544.0_x64__qbz5n2kfra8p0\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001CFF8DA60C0>
    └ <WorkerThread(AnyIO worker thread, started 9948)>
  File "C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.13_3.13.2544.0_x64__qbz5n2kfra8p0\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001CFFF287A60>
    └ <WorkerThread(AnyIO worker thread, started 9948)>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 986, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function readiness_check at 0x000001CFFF273B00>, session=<sqlmodel.orm.session.Session object at 0x000001C...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001CFFF293380>

> File "C:\Work\dppguard-backend\app\api\v1\index.py", line 17, in readiness_check
    session.exec(text("SELECT 1"))
    │       │    └ <function text at 0x000001CFFDB23380>
    │       └ <function Session.exec at 0x000001CFFF0109A0>
    └ <sqlmodel.orm.session.Session object at 0x000001CFFF2957F0>

  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlmodel\orm\session.py", line 83, in exec
    results = super().execute(
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000001CFFDF113A0>
           └ <sqlmodel.orm.session.Session object at 0x000001CFFF2957F0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2239, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
           │    └ <function Session._connection_for_bind at 0x000001CFFDF11120>
           └ <sqlmodel.orm.session.Session object at 0x000001CFFF2957F0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2108, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
           │     └ <function SessionTransaction._connection_for_bind at 0x000001CFFDF07BA0>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001CFFF0CCE10>
  File "<string>", line 2, in _connection_for_bind
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql://postgres:***@localhost:5432/dpp-guard), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001CFFF0CCE10>
                └ <function SessionTransaction._connection_for_bind at 0x000001CFFDF079C0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1187, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x000001CFFDBA13A0>
           └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    Connection._handle_dbapi_exception_noconnection(
    │          └ <classmethod(<function Connection._handle_dbapi_exception_noconnection at 0x000001CFFDB9EC00>)>
    └ <class 'sqlalchemy.engine.base.Connection'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2440, in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ ProgrammingError('invalid dsn: invalid connection option "check_same_thread"\n')
          │                    │              └ (<class 'psycopg2.ProgrammingError'>, ProgrammingError('invalid dsn: invalid connection option "check_same_thread"\n'), <trac...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.ProgrammingError) invalid dsn: invalid connection option "check_same_thread"\n')
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x000001CFFDBA1440>
    │                        └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
    └ <sqlalchemy.engine.base.Connection object at 0x000001CFFF295A90>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000001CFFD73E7A0>
           │    └ <sqlalchemy.pool.impl.QueuePool object at 0x000001CFFF08E7B0>
           └ Engine(postgresql://postgres:***@localhost:5432/dpp-guard)
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.QueuePool object at 0x000001CFFF08E7B0>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000001CFFD76C900>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.QueuePool object at 0x000001CFFF08E7B0>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000001CFFD73F420>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x000001CFFD76E700>
          └ <sqlalchemy.pool.impl.QueuePool object at 0x000001CFFF08E7B0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001CFFF2D8C40>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('invalid dsn: invalid connection option "check_same_thread"\n')
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 175, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000001CFFD73E520>
           └ <sqlalchemy.pool.impl.QueuePool object at 0x000001CFFF08E7B0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.QueuePool object at 0x000001CFFF08E7B0>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000001CFFF237950>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\__init__.py'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001CFFF2D8240>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('invalid dsn: invalid connection option "check_same_thread"\n')
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000001CFFF237950>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x000001CFFDFF5D00>
    │    │                               └ <sqlalchemy.pool.impl.QueuePool object at 0x000001CFFF08E7B0>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000001CFFF237950>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'dbname': 'dpp-guard', 'user': 'postgres', 'password': 'admin', 'port': 5432, 'check_same_thread': False}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x000001CFFDC4CE00>
           └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001CFFF08E3C0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           │    │            │        │        └ {'host': 'localhost', 'dbname': 'dpp-guard', 'user': 'postgres', 'password': 'admin', 'port': 5432, 'check_same_thread': False}
           │    │            │        └ ()
           │    │            └ <function connect at 0x000001CFFF166FC0>
           │    └ <module 'psycopg2' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\psycopg2\\__init__.py'>
           └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000001CFFF08E3C0>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\psycopg2\__init__.py", line 134, in connect
    dsn = _ext.make_dsn(dsn, **kwargs)
          │    │        │      └ {'host': 'localhost', 'dbname': 'dpp-guard', 'user': 'postgres', 'password': 'admin', 'port': 5432, 'check_same_thread': False}
          │    │        └ None
          │    └ <function make_dsn at 0x000001CFFF167880>
          └ <module 'psycopg2.extensions' from 'C:\\Work\\dppguard-backend\\.venv\\Lib\\site-packages\\psycopg2\\extensions.py'>
  File "C:\Work\dppguard-backend\.venv\Lib\site-packages\psycopg2\extensions.py", line 167, in make_dsn
    parse_dsn(dsn)
    │         └ 'host=localhost dbname=dpp-guard user=postgres password=admin port=5432 check_same_thread=False'
    └ <built-in function parse_dsn>

sqlalchemy.exc.ProgrammingError: (psycopg2.ProgrammingError) invalid dsn: invalid connection option "check_same_thread"

(Background on this error at: https://sqlalche.me/e/20/f405)
2025-12-05 00:03:46.873 | INFO     | logging:callHandlers:1737 - select pg_catalog.version()
2025-12-05 00:03:46.874 | INFO     | logging:callHandlers:1737 - [raw sql] {}
2025-12-05 00:03:46.876 | INFO     | logging:callHandlers:1737 - select current_schema()
2025-12-05 00:03:46.877 | INFO     | logging:callHandlers:1737 - [raw sql] {}
2025-12-05 00:03:46.878 | INFO     | logging:callHandlers:1737 - show standard_conforming_strings
2025-12-05 00:03:46.879 | INFO     | logging:callHandlers:1737 - [raw sql] {}
2025-12-05 00:03:46.881 | INFO     | logging:callHandlers:1737 - BEGIN (implicit)
2025-12-05 00:03:46.882 | INFO     | logging:callHandlers:1737 - SELECT 1
2025-12-05 00:03:46.882 | INFO     | logging:callHandlers:1737 - [generated in 0.00072s] {}
2025-12-05 00:03:46.885 | INFO     | logging:callHandlers:1737 - ROLLBACK
2025-12-06 00:30:33.138 | CRITICAL | app.services.user:create_user:60 - System misconfiguration: Global 'Owner' role not found.
2025-12-06 00:30:33.139 | WARNING  | app.api.v1.user:signup:40 - Signup validation failed: System error: Default roles not initialized.
2025-12-06 00:32:07.322 | CRITICAL | app.services.user:create_user:60 - System misconfiguration: Global 'Owner' role not found.
2025-12-06 00:32:07.322 | WARNING  | app.api.v1.user:signup:40 - Signup validation failed: System error: Default roles not initialized.
2025-12-06 00:41:30.526 | INFO     | app.services.user:create_user:107 - Registered user a927e72e-a785-4484-bfb8-1e171cb73114 and created tenant 7629b17a-3383-4d4b-8ec7-18e427c94476
2025-12-06 00:41:34.349 | WARNING  | app.api.v1.user:signup:40 - Signup validation failed: An user with this email already exists.
2025-12-06 00:41:36.324 | WARNING  | app.api.v1.user:signup:40 - Signup validation failed: An user with this email already exists.
2025-12-06 00:41:48.092 | INFO     | app.services.user:create_user:107 - Registered user 1bba2dda-f4ac-4e58-8048-eccbcebd4dca and created tenant a3ee9294-6ae9-4a7b-975f-a5a326073ee6
2025-12-06 00:43:42.297 | WARNING  | app.api.v1.user:signup:40 - Signup validation failed: An user with this email already exists.
2025-12-06 00:43:54.937 | WARNING  | app.api.v1.user:signup:40 - Signup validation failed: An user with this email already exists.
2025-12-06 00:43:56.185 | WARNING  | app.api.v1.user:signup:40 - Signup validation failed: An user with this email already exists.
2025-12-06 00:44:01.836 | WARNING  | app.api.v1.user:signup:40 - Signup validation failed: An user with this email already exists.
2025-12-06 00:44:09.705 | INFO     | app.services.user:create_user:107 - Registered user b552ee04-005e-4170-8f41-68bee41ee8de and created tenant 40497f9e-5b3e-4d4e-8286-8219c2313f01
2025-12-06 00:45:26.657 | INFO     | app.api.v1.user:signin:90 - User logged in: a927e72e-a785-4484-bfb8-1e171cb73114
2025-12-06 00:46:23.830 | INFO     | app.api.v1.user:signin:90 - User logged in: a927e72e-a785-4484-bfb8-1e171cb73114
2025-12-06 00:46:47.328 | INFO     | app.api.v1.user:signin:90 - User logged in: a927e72e-a785-4484-bfb8-1e171cb73114
2025-12-06 01:00:39.784 | INFO     | app.api.v1.user:signin:83 - User logged in: a927e72e-a785-4484-bfb8-1e171cb73114
2025-12-06 01:53:09.702 | INFO     | app.api.v1.auth:token:83 - User logged in: a927e72e-a785-4484-bfb8-1e171cb73114
2025-12-06 01:54:55.118 | INFO     | app.api.v1.auth:token:83 - User logged in: a927e72e-a785-4484-bfb8-1e171cb73114
2025-12-06 01:58:39.314 | INFO     | app.api.v1.auth:token:84 - User logged in: a927e72e-a785-4484-bfb8-1e171cb73114
2025-12-06 01:58:49.472 | INFO     | app.api.v1.auth:token:84 - User logged in: a927e72e-a785-4484-bfb8-1e171cb73114
2025-12-06 01:59:03.371 | WARNING  | app.api.v1.auth:signup:34 - Signup validation failed: An user with this email already exists.
